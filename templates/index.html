<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram Downloader</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" href="#" type="image/x-icon">
</head>
<body>
    <h1>Instagram Downloader</h1>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="flash {{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <!-- Radio Button Choice -->
    <div class="fetch-type-chooser">
        <label for="fetch_type_url">
            <input type="radio" id="fetch_type_url" name="fetch_type" value="url" checked onchange="toggleInput('url')">
            Post/Reel URL
        </label>
        <label for="fetch_type_stories">
            <input type="radio" id="fetch_type_stories" name="fetch_type" value="stories" onchange="toggleInput('stories')">
            Stories by Username
        </label>
    </div>

    <!-- Input Form -->
    <form action="{{ url_for('fetch_info') }}" method="post" id="fetch-form">
        <!-- Hidden input to pass fetch_type (set by JS) -->
        <input type="hidden" id="fetch_type_hidden" name="fetch_type" value="url">

        <!-- URL Input Section -->
        <div id="url-input-section">
            <label for="url">Post/Reel URL:</label>
            <input type="url" id="url" name="url" placeholder="Paste URL here (e.g., https://www.instagram.com/p/C.../)">
            <small class="input-helper-text">
                The full link to a public post or reel.
            </small>
        </div>

        <!-- Username Input Section -->
        <div id="username-input-section">
            <label for="username">Username:</label>
            <input type="text" id="username" name="username" placeholder="Enter username (e.g., instagram)">
             <small class="input-helper-text">
                Enter the exact username to fetch current public stories.
            </small>
        </div>

        <!-- Submit button -->
        <button type="submit" id="fetch-button">Fetch Info</button>
    </form>

    <!-- JavaScript for Input Toggling -->
    <script>
        const urlSection = document.getElementById('url-input-section');
        const usernameSection = document.getElementById('username-input-section');
        const urlInput = document.getElementById('url');
        const usernameInput = document.getElementById('username');
        const fetchTypeHidden = document.getElementById('fetch_type_hidden');

        function toggleInput(type) {
            if (type === 'url') {
                urlSection.style.display = 'block';
                usernameSection.style.display = 'none';
                urlInput.required = true; // Make URL input required
                usernameInput.required = false; // Make username not required
                fetchTypeHidden.value = 'url'; // Update hidden input
            } else if (type === 'stories') {
                urlSection.style.display = 'none';
                usernameSection.style.display = 'block';
                urlInput.required = false; // Make URL not required
                usernameInput.required = true; // Make username input required
                fetchTypeHidden.value = 'stories'; // Update hidden input
            }
        }

        // Initialize on page load based on checked radio
        document.addEventListener('DOMContentLoaded', () => {
            const checkedRadio = document.querySelector('input[name="fetch_type"]:checked');
            if (checkedRadio) {
                toggleInput(checkedRadio.value);
            } else {
                 toggleInput('url'); // Default to URL if nothing checked (shouldn't happen)
            }
        });

        // Loading Indicator for Fetch Button (keep existing script)
        const fetchForm = document.getElementById('fetch-form');
        const fetchButton = document.getElementById('fetch-button');
        if (fetchForm && fetchButton) {
            fetchForm.addEventListener('submit', function() {
                // Basic validation (optional, HTML5 required handles empty)
                // ... (rest of button disabling logic) ...
                fetchButton.disabled = true;
                fetchButton.textContent = 'Fetching...';
            });
        }
    </script>

</body>
</html>